
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Viewing COS Data &#8212; HST Notebooks</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Modifying or Creating an Association File" href="../AsnFile/AsnFile.html" />
    <link rel="prev" title="Downloading COS Data" href="../DataDl/DataDl.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">HST Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    STScI Notebook Repository Template
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  COS
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   COS Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Setup/Setup.html">
   Setting up your computer environment for working with COS data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DataDl/DataDl.html">
   Downloading COS Data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Viewing COS Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../AsnFile/AsnFile.html">
   Modifying or Creating an Association File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CalCOS/CalCOS.html">
   Running the COS Data Pipeline (
   <code class="docutils literal notranslate">
    <span class="pre">
     CalCOS
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../SplitTag/SplitTag.html">
   Splitting COS Exposures into sub-exposures with
   <code class="docutils literal notranslate">
    <span class="pre">
     splittag
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DayNight/DayNight.html">
   Filtering out COS Data taken during the Day or Night
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LSF/LSF.html">
   Working with the COS Line Spread Function (LSF)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Extract/Extract.html">
   Editing the extraction boxes in a spectral extraction file (XTRACTAB)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DrizzlePac
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/README.html">
   DrizzlePac Jupyter Notebook Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/Initialization/Initialization.html">
   DrizzlePac Initialization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/align_to_catalogs/align_to_catalogs.html">
   Aligning HST images to an absolute reference catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/align_multiple_visits/align_multiple_visits.html">
   Optimizing Image Alignment for Multiple HST Visits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/align_sparse_fields/align_sparse_fields.html">
   Aligning Deep Exposures of Sparse Fields
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/drizzle_wfpc2/drizzle_wfpc2.html">
   Drizzling WFPC2 Images to use a Single Zeropoint
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/mask_satellite/mask_satellite.html">
   Satellite Trail Masking Techniques
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/optimize_image_sampling/optimize_image_sampling.html">
   Optimizing the Image Sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../DrizzlePac/using_updated_astrometry_solutions/using_updated_astrometry_solutions.html">
   Using updated astrometry solutions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NICMOS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../NICMOS/nicmos_unit_conversion/nicmos_unit_conversion.html">
   Programmatic Replacements for NICMOS Units Conversion Form
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/therealzoidberg/hst_merge/main?urlpath=tree/notebooks/COS/ViewData/ViewData.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/therealzoidberg/hst_merge/blob/main/notebooks/COS/ViewData/ViewData.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="github.com/therealzoidberg/hst_merge"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="github.com/therealzoidberg/hst_merge/issues/new?title=Issue%20on%20page%20%2Fnotebooks/COS/ViewData/ViewData.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/notebooks/COS/ViewData/ViewData.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Viewing COS Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-goals">
   Learning Goals
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   0. Introduction
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-one-cell-summary-of-this-notebook-s-key-points">
     0.1. A one-cell summary of this Notebook’s key points:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#now-returning-to-our-more-detailed-walkthrough">
       Now, returning to our more detailed walkthrough
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#notes-for-those-new-to-python-jupyter-coding">
         Notes for those new to Python/Jupyter/Coding:
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-in-the-data">
   1. Reading in the data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#investigating-the-data-basics">
     1.1. Investigating the Data -
     <em>
      Basics
     </em>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-in-the-x1d-x1dsum-main-data">
     1.2. Reading in the
     <code class="docutils literal notranslate">
      <span class="pre">
       x1d
      </span>
     </code>
     /
     <code class="docutils literal notranslate">
      <span class="pre">
       x1dsum
      </span>
     </code>
     Main Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fig-1-1-from-cos-dhb-fig-1-6">
       Fig. 1.1 from COS DHB Fig. 1.6
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fig-1-2-from-cos-dhb-fig-1-10">
       Fig. 1.2 from COS DHB Fig. 1.10
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-association-asn-file">
     1.3. The Association (
     <code class="docutils literal notranslate">
      <span class="pre">
       asn
      </span>
     </code>
     ) file
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-1-1-finding-metadata-for-the-nuv">
       Exercise 1.1.
       <em>
        Finding Metadata for the NUV
       </em>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-data">
   2. Plotting the Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-an-fuv-spectrum">
     2.1. Plotting an FUV Spectrum
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#our-first-plot">
       2.1.1. Our First Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-2-1-a-clearer-plot">
       Exercise 2.1: A clearer plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-complex-look-at-the-entire-fuv">
       2.1.2. A Complex Look at the Entire FUV
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#looking-closer-at-parts-of-the-fuv-spectrum">
       2.1.3. Looking Closer at Parts of the FUV Spectrum
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-2-2-choosing-and-plotting-a-useful-data-range">
       Exercise 2.2 Choosing and plotting a useful data range
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reading-and-plotting-the-data-with-specutils-optional">
       2.1.4. Reading and plotting the data with
       <code class="docutils literal notranslate">
        <span class="pre">
         specutils
        </span>
       </code>
       (
       <em>
        OPTIONAL
       </em>
       )
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-an-nuv-spectrum">
     2.2. Plotting an NUV Spectrum
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examining-the-first-order-spectrum">
       2.2.1. Examining the first-order spectrum
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examining-the-second-order-spectrum">
       2.2.2. Examining the second-order spectrum
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preliminary-review-of-the-data">
   3. Preliminary Review of the Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-quality-and-initial-cleanup">
     3.1. Data Quality and Initial Cleanup
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-3-1-removing-all-flagged-data-from-the-nuv">
       Exercise 3.1:
       <em>
        Removing all flagged data from the NUV
       </em>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binning">
     3.2. Binning
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bringing-in-some-useful-functions-for-binning">
       3.2.1. Bringing in Some Useful Functions for Binning
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#binning-the-fuv-data">
       3.2.2. Binning the FUV Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimating-the-signal-to-noise-snr-ratio">
     3.3. Estimating the Signal-to-Noise (SNR) Ratio
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bringing-in-a-useful-function-for-estimating-snr">
       3.3.1.  Bringing in a Useful Function for Estimating SNR
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choosing-a-region-to-calculate-snr">
       3.3.2. Choosing a Region to calculate SNR
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculating-the-snr">
       3.3.3. Calculating the SNR
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-3-2-binning-the-nuv-data-and-calculating-its-snr">
       Exercise 3.2.
       <em>
        Binning the NUV Data and Calculating its SNR
       </em>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#congratulations-you-finished-this-notebook">
     Congratulations! You finished this Notebook!
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#there-are-more-cos-data-walkthrough-notebooks-on-different-topics-you-can-find-them-here">
       There are more COS data walkthrough Notebooks on different topics. You can find them here.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     About this Notebook
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#citations">
     Citations
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-solutions">
     Exercise Solutions:
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Viewing COS Data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Viewing COS Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-goals">
   Learning Goals
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   0. Introduction
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-one-cell-summary-of-this-notebook-s-key-points">
     0.1. A one-cell summary of this Notebook’s key points:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#now-returning-to-our-more-detailed-walkthrough">
       Now, returning to our more detailed walkthrough
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#notes-for-those-new-to-python-jupyter-coding">
         Notes for those new to Python/Jupyter/Coding:
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-in-the-data">
   1. Reading in the data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#investigating-the-data-basics">
     1.1. Investigating the Data -
     <em>
      Basics
     </em>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-in-the-x1d-x1dsum-main-data">
     1.2. Reading in the
     <code class="docutils literal notranslate">
      <span class="pre">
       x1d
      </span>
     </code>
     /
     <code class="docutils literal notranslate">
      <span class="pre">
       x1dsum
      </span>
     </code>
     Main Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fig-1-1-from-cos-dhb-fig-1-6">
       Fig. 1.1 from COS DHB Fig. 1.6
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fig-1-2-from-cos-dhb-fig-1-10">
       Fig. 1.2 from COS DHB Fig. 1.10
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-association-asn-file">
     1.3. The Association (
     <code class="docutils literal notranslate">
      <span class="pre">
       asn
      </span>
     </code>
     ) file
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-1-1-finding-metadata-for-the-nuv">
       Exercise 1.1.
       <em>
        Finding Metadata for the NUV
       </em>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-data">
   2. Plotting the Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-an-fuv-spectrum">
     2.1. Plotting an FUV Spectrum
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#our-first-plot">
       2.1.1. Our First Plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-2-1-a-clearer-plot">
       Exercise 2.1: A clearer plot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-complex-look-at-the-entire-fuv">
       2.1.2. A Complex Look at the Entire FUV
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#looking-closer-at-parts-of-the-fuv-spectrum">
       2.1.3. Looking Closer at Parts of the FUV Spectrum
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-2-2-choosing-and-plotting-a-useful-data-range">
       Exercise 2.2 Choosing and plotting a useful data range
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reading-and-plotting-the-data-with-specutils-optional">
       2.1.4. Reading and plotting the data with
       <code class="docutils literal notranslate">
        <span class="pre">
         specutils
        </span>
       </code>
       (
       <em>
        OPTIONAL
       </em>
       )
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-an-nuv-spectrum">
     2.2. Plotting an NUV Spectrum
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examining-the-first-order-spectrum">
       2.2.1. Examining the first-order spectrum
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examining-the-second-order-spectrum">
       2.2.2. Examining the second-order spectrum
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preliminary-review-of-the-data">
   3. Preliminary Review of the Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-quality-and-initial-cleanup">
     3.1. Data Quality and Initial Cleanup
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-3-1-removing-all-flagged-data-from-the-nuv">
       Exercise 3.1:
       <em>
        Removing all flagged data from the NUV
       </em>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binning">
     3.2. Binning
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bringing-in-some-useful-functions-for-binning">
       3.2.1. Bringing in Some Useful Functions for Binning
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#binning-the-fuv-data">
       3.2.2. Binning the FUV Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimating-the-signal-to-noise-snr-ratio">
     3.3. Estimating the Signal-to-Noise (SNR) Ratio
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bringing-in-a-useful-function-for-estimating-snr">
       3.3.1.  Bringing in a Useful Function for Estimating SNR
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choosing-a-region-to-calculate-snr">
       3.3.2. Choosing a Region to calculate SNR
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculating-the-snr">
       3.3.3. Calculating the SNR
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-3-2-binning-the-nuv-data-and-calculating-its-snr">
       Exercise 3.2.
       <em>
        Binning the NUV Data and Calculating its SNR
       </em>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#congratulations-you-finished-this-notebook">
     Congratulations! You finished this Notebook!
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#there-are-more-cos-data-walkthrough-notebooks-on-different-topics-you-can-find-them-here">
       There are more COS data walkthrough Notebooks on different topics. You can find them here.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     About this Notebook
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#citations">
     Citations
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-solutions">
     Exercise Solutions:
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><a id="topV"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="viewing-cos-data">
<h1>Viewing COS Data<a class="headerlink" href="#viewing-cos-data" title="Permalink to this headline">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="learning-goals">
<h1>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this headline">#</a></h1>
<p><font size="4 ">This Notebook is designed to walk the user (<em>you</em>) through:</font><br></p>
<p><strong>0. <a class="reference external" href="#introV">Introduction</a></strong></p>
<p>- 0.1. <a class="reference external" href="#onecellV">A one-cell summary of this Notebook’s key points</a></p>
<p><strong>1. <a class="reference external" href="#readInV">Reading in the data</a> using <code class="docutils literal notranslate"><span class="pre">Python</span></code></strong></p>
<p>- 1.1. <a class="reference external" href="#investV">Investigating the Data - <em>Basics</em></a></p>
<p>- 1.2. <a class="reference external" href="#readmainV">Reading in the <code class="docutils literal notranslate"><span class="pre">x1d</span></code>/<code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> Main Data</a></p>
<p>- 1.3. <a class="reference external" href="#assocV">The Association (<code class="docutils literal notranslate"><span class="pre">asn</span></code>) file</a></p>
<p><strong>2. <a class="reference external" href="#plottingV">Displaying the data</a> using common plotting techniques</strong></p>
<p>- 2.1. <a class="reference external" href="#fuvV">Plotting an FUV Spectrum</a></p>
<blockquote>
<div><p>2.1.1. <a class="reference external" href="#p1V">Our First Plot</a></p>
</div></blockquote>
<blockquote>
<div><p>2.1.2. <a class="reference external" href="#plotcompV">A Complex Look at the Entire FUV</a></p>
</div></blockquote>
<blockquote>
<div><p>2.1.3. <a class="reference external" href="#plotcloserV">Looking Closer at Parts of the FUV Spectrum</a></p>
</div></blockquote>
<blockquote>
<div><p>2.1.4. <a class="reference external" href="#specvizV">Reading and plotting the data with <code class="docutils literal notranslate"><span class="pre">specutils</span></code> (<em>optional</em>)</a></p>
</div></blockquote>
<p>- 2.2. <a class="reference external" href="#nuvV">Plotting an NUV Spectrum</a></p>
<blockquote>
<div><p>2.2.1. <a class="reference external" href="#nuv1V">Examining the first-order spectrum</a></p>
</div></blockquote>
<blockquote>
<div><p>2.2.2. <a class="reference external" href="#nuv2V">Examining the second-order spectrum</a></p>
</div></blockquote>
<p><strong>3. <a class="reference external" href="#AssessingV">Making a quick assessment of the data</a> with tools to bin and measure the data’s SNR and resolution</strong></p>
<p>- 3.1. <a class="reference external" href="#DataQualV">Understanding and Using Data Quality Flags</a></p>
<p>- 3.2. <a class="reference external" href="#BinningV">Binning the Data</a></p>
<blockquote>
<div><p>3.2.1. <a class="reference external" href="#BinfunV">Bringing in Some Useful Functions for Binning</a></p>
</div></blockquote>
<blockquote>
<div><p>3.2.2. <a class="reference external" href="#binfuvV">Binning the FUV Data</a></p>
</div></blockquote>
<p>- 3.3. <a class="reference external" href="#SnrV">Calculating the Signal-to-Noise Ratio</a></p>
<blockquote>
<div><p>3.3.1. <a class="reference external" href="#snrfunV">Defining a Useful Function for Estimating SNR</a></p>
</div></blockquote>
<blockquote>
<div><p>3.3.2. <a class="reference external" href="#snrregV">Choosing a Region to calculate SNR</a></p>
</div></blockquote>
<blockquote>
<div><p>3.3.3. <a class="reference external" href="#snrcalcV">Calculating the SNR</a></p>
</div></blockquote>
<p><em>If you’re confident with Reading-in and Plotting data in Python, you may run the first few cells defining directories and importing modules and then click the link when it appears to go ahead and skip to Section 3.</em></p>
<p><a id=introV></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>0. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h1>
<p><strong>The Cosmic Origins Spectrograph (<a class="reference external" href="https://www.nasa.gov/content/hubble-space-telescope-cosmic-origins-spectrograph"><em>COS</em></a>) is an ultraviolet spectrograph on-board the Hubble Space Telescope (<a class="reference external" href="https://www.stsci.edu/hst/about"><em>HST</em></a>) with capabilities in the near ultraviolet (<em>NUV</em>) and far ultraviolet (<em>FUV</em>).</strong></p>
<p><strong>This tutorial aims to prepare you to begin analyzing COS data of your choice by walking you through reading and viewing a spectrum obtained with COS, as well as obtaining a few diagnostic measurements of your spectrum.</strong></p>
<ul class="simple">
<li><p>For an in-depth manual to working with COS data and a discussion of caveats and user tips, see the <a class="reference external" href="https://hst-docs.stsci.edu/display/COSDHB/">COS Data Handbook</a>.</p></li>
<li><p>For a detailed overview of the COS instrument, see the <a class="reference external" href="https://hst-docs.stsci.edu/display/COSIHB/">COS Instrument Handbook</a>.</p></li>
</ul>
<p><a id=onecellV></a></p>
<section id="a-one-cell-summary-of-this-notebook-s-key-points">
<h2>0.1. A one-cell summary of this Notebook’s key points:<a class="headerlink" href="#a-one-cell-summary-of-this-notebook-s-key-points" title="Permalink to this headline">#</a></h2>
<p>While the rest of this Notebook will walk you through each step and decision made when examining your COS data, the following code cell serves as a summary for the Notebook. It contains the key material condensed into a single code cell, without much explanation. If this is all the help you need, great! If you still have questions, read on!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This code cell condenses the key material of the Notebook into a single cell summary.</span>

<span class="c1"># 1. Import the necessary libraries:</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span> <span class="nn">cos_functions</span> <span class="kn">import</span> <span class="n">estimate_snr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># 2. Download an example dataset using astroquery:</span>
<span class="c1"># For more information, see the &quot;Downloading your data&quot; Notebook in this git repository</span>
<span class="n">onecell_x1dsum_data_products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span>
    <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span>
        <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span>
            <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span>
                <span class="n">obs_id</span><span class="o">=</span><span class="s2">&quot;LDM701020&quot;</span>  <span class="c1"># The Obs ID of the observation to download</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="c1"># Only downloads the 1 dimensional extracted spectrum</span>
        <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="s2">&quot;X1DSUM&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># 3. Read in the data to an Astropy Table:</span>
<span class="n">x1dsum_data_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">onecell_x1dsum_data_products</span><span class="p">[</span><span class="s2">&quot;Local Path&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Some users may be familiar with another way to read in FITS table data, though it can be less user-friendly:</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">onecell_x1dsum_data_products</span><span class="p">[</span><span class="s2">&quot;Local Path&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
    <span class="n">alternate_x1dsum_data_structure</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># 4. Estimate the S/N ratio of the spectrum by calculating sqrt(counts):</span>
<span class="c1">#    The `estimate_snr` function is defined in the associated file: `cos_functions.py`</span>
<span class="n">SNR_estimate</span> <span class="o">=</span> <span class="n">estimate_snr</span><span class="p">(</span><span class="n">x1dsum_data_table</span><span class="p">,</span> <span class="n">binsize_</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># 5. Create a plot of the spectrum and the estimated S/N:</span>
<span class="c1"># Create 2-subplots and populate the upper one with the flux and the lower with S/N:</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">segment_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x1dsum_data_table</span><span class="p">):</span>
    <span class="c1"># In the upper panel, plot the spectrum as Flux over Wavelength:</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">segment_row</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span>
             <span class="n">segment_row</span><span class="p">[</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Segment FUV</span><span class="si">{</span><span class="s1">&#39;AB&#39;</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># In the lower panel, plot the S/N ratio as estimated S/N over Wavelength:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SNR_estimate</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">SNR_estimate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
             <span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Segment FUV</span><span class="si">{</span><span class="s1">&#39;AB&#39;</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Format the plot and save</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># Adds a title of fontsize 20 points</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fig. 0.1</span><span class="se">\n</span><span class="s2">Simple COS G160M Spectrum&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># Adds y axis label to the top panel</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Adds y axis label to the bottom panel</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
    <span class="s1">&#39;Estimated  $\dfrac</span><span class="si">{SIGNAL}{NOISE}</span><span class="s1">$  for a resolution element&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Adds x axis label to the bottom panel</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./Fig_0.1_quick_plot.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/ldm701020_x1dsum.fits to ./mastDownload/HST/ldm701020/ldm701020_x1dsum.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
</pre></div>
</div>
<img alt="../../../_images/ViewData_3_3.png" src="../../../_images/ViewData_3_3.png" />
</div>
</div>
<section id="now-returning-to-our-more-detailed-walkthrough">
<h3>Now, returning to our more detailed walkthrough<a class="headerlink" href="#now-returning-to-our-more-detailed-walkthrough" title="Permalink to this headline">#</a></h3>
<section id="notes-for-those-new-to-python-jupyter-coding">
<h4>Notes for those new to Python/Jupyter/Coding:<a class="headerlink" href="#notes-for-those-new-to-python-jupyter-coding" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>You will frequently see exclamation points (<strong>!</strong>) or dollar signs (<strong>$</strong>) at the beginning of a line of code we are telling you to run. These are not part of the actual commands. The exclamation points tell a jupyter Notebook to pass the following line to the command line, and the dollar sign merely indicates the start of a terminal prompt.</p></li>
</ul>
<p><font size="5"> We will import the following packages:</font></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">numpy</span></code> to handle array functions (version <span class="math notranslate nohighlight">\(\ge\)</span> 1.17)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pathlib</span></code> for managing system paths.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.io</span> <span class="pre">fits</span></code> for accessing FITS files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.table</span> <span class="pre">Table</span></code> for creating tidy tables of the data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astropy.units</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy.visualization.quantity_support</span></code> for dealing with units</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code> for plotting data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">astroquery.mast</span> <span class="pre">Observations</span></code> for finding and downloading data from the <a class="reference external" href="https://mast.stsci.edu/portal/Mashup/Clients/Mast/Portal.html">MAST</a> archive</p></li>
</ul>
<p><em>Later on, we will import some functions from a local file</em>, <code class="docutils literal notranslate"><span class="pre">cos_functions.py</span></code>, which is installed as part of the same GitHub repository as this Notebook. If you do not see this <code class="docutils literal notranslate"><span class="pre">Python</span></code> file in this directory, you can find it <a class="reference external" href="https://github.com/spacetelescope/notebooks/tree/master/notebooks/COS/ViewData/">here</a>. <code class="docutils literal notranslate"><span class="pre">cos_functions.py</span></code> must be installed next to this Notebook (<code class="docutils literal notranslate"><span class="pre">ViewData.ipynb</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports for: Downloading data from archive</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>

<span class="c1"># Import for: Plotting</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># This line causes matplotlib plots to appear in the Notebook</span>
<span class="c1">#   instead of possibly showing up in separate windows</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Import for: Manipulating arrays</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Import for: Managing system variables and paths</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Imports for: Reading in data</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>

<span class="c1"># Imports for: Dealing with units and plotting them</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">quantity_support</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="n">quantity_support</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;astropy.visualization.units.quantity_support.&lt;locals&gt;.MplQuantityConverter at 0x7f0cb0650310&gt;
</pre></div>
</div>
</div>
</div>
<p><font size="5"> We will also define a few directories in which to place our data and plots, as well as a few colors we will use in plots later.</font></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These will be important directories for the Notebook</span>

<span class="n">datadir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./data&#39;</span><span class="p">)</span>
<span class="n">outputsdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./output/&#39;</span><span class="p">)</span>
<span class="n">plotsdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./output/plots&#39;</span><span class="p">)</span>
<span class="c1"># Make the directories if they don&#39;t exist</span>
<span class="n">datadir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">outputsdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
    <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">plotsdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Specifying a few arbitrary colors to correspond to COS segments for plotting by their hex code</span>
<span class="c1"># Many search engines will show you the hex color - i.e. Google &quot;#BC8C5B&quot; to see this orange color</span>
<span class="n">segment_colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FUVA&#39;</span><span class="p">:</span> <span class="s1">&#39;#BC8C5B&#39;</span><span class="p">,</span> <span class="s1">&#39;FUVB&#39;</span><span class="p">:</span> <span class="s1">&#39;#4B6CA4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;NUVA&#39;</span><span class="p">:</span> <span class="s1">&#39;#1813CE&#39;</span><span class="p">,</span> <span class="s1">&#39;NUVB&#39;</span><span class="p">:</span> <span class="s1">&#39;#61946E&#39;</span><span class="p">,</span> <span class="s1">&#39;NUVC&#39;</span><span class="p">:</span> <span class="s1">&#39;#8C1A11&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p><font size="5">We will be working with some FUV and NUV datasets downloaded in the cell below. </font></p>
<p>These two datasets contain FUV observations of the QSO <em>3C48</em> and NUV observations of the Star <em>WD1057 + 719</em>, respectively.</p>
<p>Searching for and downloading data is out of the scope of this tutorial. If you wish to learn more, please see our <a class="reference external" href="https://github.com/spacetelescope/notebooks/blob/master/notebooks/COS/DataDl/DataDl.ipynb">tutorial on downloading COS data</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the NUV data on WD1057+719 (with the G230L grating); only the _x1dsum and _asn</span>
<span class="n">nuv_downloads</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;lbbd01020&#39;</span><span class="p">)),</span>
                                               <span class="n">download_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="p">),</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;fits&#39;</span><span class="p">,</span> <span class="n">mrp_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Download the FUV data on QSO 3C48; only the _x1dsum and _asn</span>
<span class="n">fuv_downloads</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">obs_id</span><span class="o">=</span><span class="s1">&#39;lcxv13050&#39;</span><span class="p">)),</span>
                                               <span class="n">download_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">datadir</span><span class="p">),</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;fits&#39;</span><span class="p">,</span> <span class="n">mrp_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lbbd01020_asn.fits to data/mastDownload/HST/lbbd01020/lbbd01020_asn.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lbbd01020_x1dsum.fits to data/mastDownload/HST/lbbd01020/lbbd01020_x1dsum.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13050_asn.fits to data/mastDownload/HST/lcxv13050/lcxv13050_asn.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:HST/product/lcxv13050_x1dsum.fits to data/mastDownload/HST/lcxv13050/lcxv13050_x1dsum.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
<p><strong>If you’re confident Reading-in and Plotting data in Python, now go ahead to <a class="reference external" href="#AssessingV">Section 3</a></strong></p>
<p><a id="readInV"></a></p>
</section>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="reading-in-the-data">
<h1>1. Reading in the data<a class="headerlink" href="#reading-in-the-data" title="Permalink to this headline">#</a></h1>
<p>Calibrated COS 1-dimensional spectra are stored in fits files with the suffix <code class="docutils literal notranslate"><span class="pre">x1d</span></code> or <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> (<em>1-dimensional here means that the cross-dispersion axis has been collapsed</em>).
<code class="docutils literal notranslate"><span class="pre">x1d</span></code> files contain a spectrum processed from a single exposure, while <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> files contain summed data from multiple exposures at different fixed pattern noise position settings (FP-POS’s). You may also encounter <code class="docutils literal notranslate"><span class="pre">x1dsumN</span></code> files, i.e. <code class="docutils literal notranslate"><span class="pre">x1dsum1</span></code>/<code class="docutils literal notranslate"><span class="pre">x1dsum2</span></code>/<code class="docutils literal notranslate"><span class="pre">x1dsum3</span></code>/<code class="docutils literal notranslate"><span class="pre">x1dsum4</span></code>, which are intermediate files containing data from multiple exposures at the same FP-POS. All of these files are sub-types of <code class="docutils literal notranslate"><span class="pre">x1d</span></code> files and thus share the same basic data structure. What you learn with one filetype is transferable to working with another.
We will be working with <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> files in this tutorial; however, please note that we often use the shorthand “<code class="docutils literal notranslate"><span class="pre">x1d</span></code>” as part of a variable name when programming, regardless of whether it is a summed file or not.</p>
<p>The calibrated spectrum data has been downloaded onto our local machine as: <strong>&lt;<code class="docutils literal notranslate"><span class="pre">current-working-directory</span></code>&gt;</strong><code class="docutils literal notranslate"><span class="pre">/data/mastDownload/HST/</span></code><strong>&lt;<code class="docutils literal notranslate"><span class="pre">Obs_id</span></code>&gt;</strong><code class="docutils literal notranslate"><span class="pre">/</span></code><strong>&lt;<code class="docutils literal notranslate"><span class="pre">Obs_id</span></code>&gt;</strong><code class="docutils literal notranslate"><span class="pre">_x1dsum.fits</span></code>,
where the NUV and FUV Data are contained in the obs_ids:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Spectral Region</p></th>
<th class="head"><p>Obs_id</p></th>
<th class="head"><p>Object Name</p></th>
<th class="head"><p>Object Type</p></th>
<th class="head"><p>filepath</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>FUV</p></td>
<td><p>LCXV13050</p></td>
<td><p>QSO</p></td>
<td><p>3C48</p></td>
<td><p>./data/mastDownload/HST/lcxv13050</p></td>
</tr>
<tr class="row-odd"><td><p>NUV</p></td>
<td><p>LBBD01020</p></td>
<td><p>Star</p></td>
<td><p>WD1057 + 719</p></td>
<td><p>./data/mastDownload/HST/lbbd01020</p></td>
</tr>
</tbody>
</table>
<p><a id="investV"></a></p>
<section id="investigating-the-data-basics">
<h2>1.1. Investigating the Data - <em>Basics</em><a class="headerlink" href="#investigating-the-data-basics" title="Permalink to this headline">#</a></h2>
<p>We want to learn the basics about this file, then read in the data.</p>
<p>We can learn a great deal about our data from its primary fits header (see cell below).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure these filepath variables point to your new FUV data</span>
<span class="c1"># Note, We&#39;ll often refer to the x1dsum file with the prefix x1d for convenience</span>
<span class="c1"># However, the files are x1dsum files, not the related x1d files - more info in the Data Handbook</span>
<span class="n">fuv_x1d_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
    <span class="s1">&#39;./data/mastDownload/HST/lcxv13050/lcxv13050_x1dsum.fits&#39;</span><span class="p">)</span>
<span class="c1"># This is the association file, used for processing spectra with CalCOS:</span>
<span class="n">fuv_asn_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./data/mastDownload/HST/lcxv13050/lcxv13050_asn.fits&#39;</span><span class="p">)</span>

<span class="c1"># Make sure these point to your new NUV data</span>
<span class="n">nuv_x1d_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
    <span class="s1">&#39;./data/mastDownload/HST/lbbd01020/lbbd01020_x1dsum.fits&#39;</span><span class="p">)</span>
<span class="c1"># This is the NUV association file</span>
<span class="n">nuv_asn_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./data/mastDownload/HST/lbbd01020/lbbd01020_asn.fits&#39;</span><span class="p">)</span>


<span class="n">nuv_x1d_header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">nuv_x1d_filepath</span><span class="p">)</span>
<span class="n">nuv_asn_header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">nuv_asn_filepath</span><span class="p">)</span>

<span class="n">fuv_x1d_header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">fuv_x1d_filepath</span><span class="p">)</span>
<span class="n">fuv_asn_header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">fuv_asn_filepath</span><span class="p">)</span>

<span class="c1"># This is the primary, 0th header of the calibrated nuv spectrum;</span>
<span class="n">fuv_x1d_header</span><span class="p">[:</span><span class="mi">18</span><span class="p">],</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">fuv_x1d_header</span><span class="p">[</span><span class="mi">45</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>
<span class="c1"># This is *not* the whole header...</span>
<span class="c1"># ...The [:18] and [45:50] tell Python to print the first 18 lines, as well as lines 45-50</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(SIMPLE  =                    T / conforms to FITS standard                      
 BITPIX  =                    8 / array data type                                
 NAXIS   =                    0 / number of array dimensions                     
 EXTEND  =                    T                                                  
 NEXTEND =                    1 / Number of standard extensions                  
 DATE    = &#39;2023-01-20&#39;         / date this file was written (yyyy-mm-dd)        
 FILENAME= &#39;lcxv13050_x1dsum.fits&#39; / name of file                                
 FILETYPE= &#39;SCI      &#39;          / type of data found in data file                
                                                                                 
 TELESCOP= &#39;HST&#39;                / telescope used to acquire data                 
 INSTRUME= &#39;COS   &#39;             / identifier for instrument used to acquire data 
 EQUINOX =               2000.0 / equinox of celestial coord. system             
                                                                                 
               / DATA DESCRIPTION KEYWORDS                                       
                                                                                 
 ROOTNAME= &#39;lcxv13flq                         &#39; / rootname of the observation set
 IMAGETYP= &#39;TIME-TAG          &#39; / type of exposure identifier                    
 PRIMESI = &#39;COS   &#39;             / instrument designated as prime                 ,
 &#39;...&#39;,
               / DIAGNOSTIC KEYWORDS                                             
                                                                                 
 PROCTIME=   5.996418449074E+04 / pipeline processing time (MJD)                 
 OPUS_VER= &#39;HSTDP 2022_3                &#39; / data processing software system versi
 AWSYSVER= &#39;v0.4.38 &#39;           / cloud infrastructure package version           )
</pre></div>
</div>
</div>
</div>
<p>For instance, we notice that the FUV data was taken in <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-5-cos-data-analysis/5-4-working-with-time-tag-data">TIME-TAG mode</a> and calibrated with <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> version <code class="docutils literal notranslate"><span class="pre">3.3.10</span></code> (at the time of writing this sentence - it may have been reprocessed by the time you read this).</p>
<p>However, some metadata information, such as the time of observation and calculated exposure time, can be found in the <strong>1-th header</strong> rather than the 0th. We will read and print this below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fuv_x1d_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdu</span><span class="p">:</span>
    <span class="n">fuv_x1d_header1</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
    <span class="n">fuv_date</span> <span class="o">=</span> <span class="n">fuv_x1d_header1</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">]</span>
    <span class="n">fuv_time</span> <span class="o">=</span> <span class="n">fuv_x1d_header1</span><span class="p">[</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">]</span>
    <span class="n">fuv_exptime</span> <span class="o">=</span> <span class="n">fuv_x1d_header1</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">]</span>

<span class="c1"># It&#39;s also perfectly valid to access the 1-th extension header using &#39;fits.getheader(fuv_x1d_filepath, ext=1)&#39;</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;This FUV data was taken on </span><span class="si">{</span><span class="n">fuv_date</span><span class="si">}</span><span class="s2"> starting at </span><span class="si">{</span><span class="n">fuv_time</span><span class="si">}</span><span class="s2"> with a net exposure time of </span><span class="si">{</span><span class="n">fuv_exptime</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">nuv_x1d_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdu</span><span class="p">:</span>
    <span class="n">nuv_x1d_header1</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
    <span class="n">nuv_date</span> <span class="o">=</span> <span class="n">nuv_x1d_header1</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">]</span>
    <span class="n">nuv_time</span> <span class="o">=</span> <span class="n">nuv_x1d_header1</span><span class="p">[</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">]</span>
    <span class="n">nuv_exptime</span> <span class="o">=</span> <span class="n">nuv_x1d_header1</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;This NUV data was taken on </span><span class="si">{</span><span class="n">nuv_date</span><span class="si">}</span><span class="s2"> starting at </span><span class="si">{</span><span class="n">nuv_time</span><span class="si">}</span><span class="s2"> with a net exposure time of </span><span class="si">{</span><span class="n">nuv_exptime</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This FUV data was taken on 2016-06-13 starting at 23:56:29 with a net exposure time of 6532.512 seconds.
This NUV data was taken on 2009-08-14 starting at 06:03:56 with a net exposure time of 999.136 seconds.
</pre></div>
</div>
</div>
</div>
<p><a id=readmainV></a></p>
</section>
<section id="reading-in-the-x1d-x1dsum-main-data">
<h2>1.2. Reading in the <code class="docutils literal notranslate"><span class="pre">x1d</span></code>/<code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> Main Data<a class="headerlink" href="#reading-in-the-x1d-x1dsum-main-data" title="Permalink to this headline">#</a></h2>
<p>The data are in the 1-th header-data unit (HDU) of our fits file. There are several ways to read in our data from the our table-formatted fits file. We’ll demonstrate three common methods below, focusing in on the <a class="reference external" href="https://docs.astropy.org/en/stable/io/unified.html#getting-started-with-table-i-o"><code class="docutils literal notranslate"><span class="pre">astropy.table</span></code></a> method.
We will then display all the fields contained in this data table using the <code class="docutils literal notranslate"><span class="pre">.colnames</span></code> method. You can ignore the warnings about multiple slashes in the units that come up while reading in the data. The proper units are displayed in LaTex as:</p>
<ul class="simple">
<li><p>‘erg /s /cm**2 /angstrom’  ==&gt; $<span class="math notranslate nohighlight">\(\ \ erg\ s^{-1}\ cm^{-2}\ \mathring{A}^{-1}\)</span>$</p></li>
<li><p>‘count /s /pixel’          ==&gt; $<span class="math notranslate nohighlight">\(\ \ counts\ s^{-1}\ pixel^{-1}\)</span>$</p></li>
</ul>
<p>The columns of these tables include some scalar values which <em>describe</em> the data (i.e. EXPTIME), while the columns containing actual data hold it in arrays of equal length (i.e. WAVELENGTH, FLUX, etc., where that length = NELEM).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Method number 1:</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fuv_x1d_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
    <span class="n">fuv_x1d_data</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method 1 gets data as type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">fuv_x1d_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Method number 2:</span>
<span class="n">fuv_x1d_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">fuv_x1d_filepath</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method 2 gets data as type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">fuv_x1d_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Method number 3:</span>
<span class="n">fuv_x1d_data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fuv_x1d_filepath</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method 3 gets data as type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">fuv_x1d_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># We can easily explore this astropy table</span>
<span class="n">columns</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="o">.</span><span class="n">colnames</span>
<span class="c1"># Print basic info about the table&#39;s columns</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Table of FUV data with columns:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Display a representation of the data table:</span>
<span class="n">fuv_x1d_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Method 1 gets data as type: &lt;class &#39;astropy.io.fits.fitsrec.FITS_rec&#39;&gt;
Method 2 gets data as type: &lt;class &#39;astropy.io.fits.fitsrec.FITS_rec&#39;&gt;
Method 3 gets data as type: &lt;class &#39;astropy.table.table.Table&#39;&gt;

Table of FUV data with columns:
 [&#39;SEGMENT&#39;, &#39;EXPTIME&#39;, &#39;NELEM&#39;, &#39;WAVELENGTH&#39;, &#39;FLUX&#39;, &#39;ERROR&#39;, &#39;ERROR_LOWER&#39;, &#39;GROSS&#39;, &#39;GCOUNTS&#39;, &#39;VARIANCE_FLAT&#39;, &#39;VARIANCE_COUNTS&#39;, &#39;VARIANCE_BKG&#39;, &#39;NET&#39;, &#39;BACKGROUND&#39;, &#39;DQ&#39;, &#39;DQ_WGT&#39;] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
</pre></div>
</div>
<div class="output text_html"><div><i>Table length=2</i>
<table id="table139692539164032" class="table-striped table-bordered table-condensed">
<thead><tr><th>SEGMENT</th><th>EXPTIME</th><th>NELEM</th><th>WAVELENGTH</th><th>FLUX</th><th>ERROR</th><th>ERROR_LOWER</th><th>GROSS</th><th>GCOUNTS</th><th>VARIANCE_FLAT</th><th>VARIANCE_COUNTS</th><th>VARIANCE_BKG</th><th>NET</th><th>BACKGROUND</th><th>DQ</th><th>DQ_WGT</th></tr></thead>
<thead><tr><th></th><th>s</th><th></th><th>Angstrom</th><th>erg / (Angstrom cm2 s)</th><th>erg / (Angstrom cm2 s)</th><th>ct / s</th><th>ct / s</th><th>ct</th><th>ct</th><th>ct</th><th>ct</th><th>ct / s</th><th>ct / s</th><th></th><th></th></tr></thead>
<thead><tr><th>bytes4</th><th>float64</th><th>int32</th><th>float64[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>float32[16384]</th><th>int16[16384]</th><th>float32[16384]</th></tr></thead>
<tr><td>FUVA</td><td>6532.512</td><td>16384</td><td>1610.240833382022 .. 1810.9448636791044</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>128 .. 128</td><td>0.0 .. 0.0</td></tr>
<tr><td>FUVB</td><td>6532.512</td><td>16384</td><td>1421.9464241857759 .. 1622.5957869332851</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>0.0 .. 0.0</td><td>128 .. 128</td><td>0.0 .. 0.0</td></tr>
</table></div></div></div>
</div>
<p><strong>In the case of the FUV data, we see an astropy style table of 2 rows</strong> which are labeled FUVA and FUVB. These rows contain data from the 2 segments of FUV Detector (see figure 1.1).</p>
<section id="fig-1-1-from-cos-dhb-fig-1-6">
<h3>Fig. 1.1 from <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-1-cos-overview/1-2-cos-physical-configuration#id-1.2COSPhysicalConfiguration-Figure1.6">COS DHB Fig. 1.6</a><a class="headerlink" href="#fig-1-1-from-cos-dhb-fig-1-6" title="Permalink to this headline">#</a></h3>
<center>
    <img src=figures/cosdhb_fig1p6.jpg width ="900" title="Layout of the COS FUV detector">
    <figcaption>Layout of the COS FUV detector. Note that FUVB corresponds to shorter wavelengths than FUVA.</figcaption>
</center>
<p><strong>In the case of the NUV data, we see a similar astropy style table of 3 rows</strong> (labeled NUVA, NUVB, and NUVC). These rows contain data from the 3 stripes of the NUV spectrum (see figure 1.2).</p>
</section>
<section id="fig-1-2-from-cos-dhb-fig-1-10">
<h3>Fig. 1.2 from <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-1-cos-overview/1-2-cos-physical-configuration#id-1.2COSPhysicalConfiguration-Figure1.10">COS DHB Fig. 1.10</a><a class="headerlink" href="#fig-1-2-from-cos-dhb-fig-1-10" title="Permalink to this headline">#</a></h3>
<center>
    <img src=figures/ch1_cos_overview3.10.jpg width ="900" title="An example COS NUV spectrum">
    <figcaption>An example COS NUV spectrum. The spectrum itself, taken with the Primary Science Aperture, is in the lower three stripes labeled 'PSA'. The upper stripes, labeled 'WCA' are for wavelength calibration.</figcaption>
</center>
<p>An important thing to note about this <em>NUV</em> data in particular is that with the grating used here (G230L), stripe C is actually a 2nd order spectrum with a higher dispersion and ~5% contamination from the 1st order spectrum. See the <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-1-cos-overview/1-1-instrument-capabilities-and-design#id-1.1InstrumentCapabilitiesandDesign-NUVSpectroscopyNUVSpectroscopy">COS Data Handbook</a>, <em>especially Fig. 1.3,</em> for more information.</p>
<p><a id=assocV></a></p>
</section>
</section>
<section id="the-association-asn-file">
<h2>1.3. The Association (<code class="docutils literal notranslate"><span class="pre">asn</span></code>) file<a class="headerlink" href="#the-association-asn-file" title="Permalink to this headline">#</a></h2>
<p>It’s also likely we will want to see what observations went into making this calibrated spectrum. This information is contained in the Association (<code class="docutils literal notranslate"><span class="pre">asn</span></code>) file, under the MEMNAME column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">fuv_asn_filepath</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">----</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">fuv_asn_data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fuv_asn_filepath</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fuv_asn_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Filename: data/mastDownload/HST/lcxv13050/lcxv13050_asn.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU      43   ()      
  1  ASN           1 BinTableHDU     25   5R x 3C   [14A, 14A, L]   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None 

----

   MEMNAME        MEMTYPE     MEMPRSNT
-------------- -------------- --------
     LCXV13FLQ         EXP-FP        1
     LCXV13FXQ         EXP-FP        1
     LCXV13G4Q         EXP-FP        1
     LCXV13GXQ         EXP-FP        1
     LCXV13050        PROD-FP        1
</pre></div>
</div>
</div>
</div>
<p>We see that our data has MEMTYPE = <code class="docutils literal notranslate"><span class="pre">PROD-FP</span></code>, meaning it is an output science product (see COS DHB <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-2-cos-data-files/2-4-cos-data-products">Table 2.6</a>.)</p>
<p>This particular association file lists four <code class="docutils literal notranslate"><span class="pre">EXP-FP</span></code> (input science exposure), with the <code class="docutils literal notranslate"><span class="pre">MEMNAME</span></code> values (Dataset IDs) <code class="docutils literal notranslate"><span class="pre">[LCXV13FLQ,</span> <span class="pre">LCXV13FXQ,</span> <span class="pre">LCXV13G4Q,</span> <span class="pre">LCXV13GXQ]</span></code>. We could look for these datasets, if we wished to inspect the exposures individually.</p>
<section id="exercise-1-1-finding-metadata-for-the-nuv">
<h3>Exercise 1.1. <em>Finding Metadata for the NUV</em><a class="headerlink" href="#exercise-1-1-finding-metadata-for-the-nuv" title="Permalink to this headline">#</a></h3>
<ol class="simple">
<li><p>Read in the NUV data, just as we did with the FUV data.</p></li>
<li><p>From the 0th header of the <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> file, determine the time (in MJDs) that the data was processed. (keyword = PROCTIME) and from the 1th header, determine how many wavelength calibration “flashes” were used (keyword = NUMFLASH)</p></li>
<li><p>From the <code class="docutils literal notranslate"><span class="pre">asn</span></code> file, determine how many input science exposures went into the NUV x1dsum file.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code here</span>
</pre></div>
</div>
</div>
</div>
<p><a id="plottingV"></a></p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="plotting-the-data">
<h1>2. Plotting the Data<a class="headerlink" href="#plotting-the-data" title="Permalink to this headline">#</a></h1>
<p><a id = fuvV></a></p>
<section id="plotting-an-fuv-spectrum">
<h2>2.1. Plotting an FUV Spectrum<a class="headerlink" href="#plotting-an-fuv-spectrum" title="Permalink to this headline">#</a></h2>
<p><strong>Let’s select the simplest data we need to plot a spectrum:</strong> <font size="4"><b>WAVELENGTH, FLUX, and ERROR.</b></font></p>
<ul class="simple">
<li><p><em>Note that here, ERROR is flux error, which is discussed in the COS Instrument Handbook</em></p></li>
<li><p><em>Also note that somewhat counterintuitively, the FUVB segment extends over shorter wavelengths than the FUVA.</em></p></li>
</ul>
<p><a id = p1V></a></p>
<section id="our-first-plot">
<h3>2.1.1. Our First Plot<a class="headerlink" href="#our-first-plot" title="Permalink to this headline">#</a></h3>
<p><strong>We begin with a simple plot: simply a line plot of a single segment (FUVA) without its error.</strong>
The goal of this show is to demonstrate some of the common parameters of making a simple plot with <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> which you are likely to often need. The comments explain what each line does.</p>
<p><a id="fig2p1"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># [0] Access FUVA data, the longer wvln segment and gets the data we need to plot a spectrum:</span>
<span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">,</span> <span class="s2">&quot;FLUX&quot;</span><span class="p">,</span> <span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

<span class="c1"># Set up the plot as a single box with size of 10x4 inches, and with a dpi of 100, relevant should we choose to save it:</span>
<span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># The next few lines are the core of the cell, where we actually place the data onto the plot:</span>
<span class="c1">###############</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>  <span class="c1"># First two arguments are assumed to be the x-data, y-data</span>
        <span class="c1"># These parameters specify the look of the connecting line</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="c1"># The marker parameters specify how the data points will look...</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="c1"># ... if you don&#39;t want dots set marker=&#39;&#39;</span>
        <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">)</span>  <span class="c1"># The label is an optional parameter which will allow us to create a legend</span>
<span class="c1"># this label is useful when there are multiple datasets on the same plot</span>

<span class="c1"># The lines after this are all about formatting, adding text, and saving as an image</span>
<span class="c1">###############</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fig. 2.1</span><span class="se">\n</span><span class="s2">Simple COS Segment FUVA Spectrum&quot;</span><span class="p">,</span>
             <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># Adds a title of fontsize 20 points</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>  <span class="c1"># Adds x axis label</span>
<span class="c1"># Adds y label</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># These two lines set the x and y bounds of the image in whatever units we are plotting in</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1605</span><span class="p">,</span> <span class="mi">1815</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1E-15</span><span class="p">,</span> <span class="mf">1.85E-14</span><span class="p">)</span>

<span class="c1"># Adds a legend with the label specified in the plotting call</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Trims blank space</span>
<span class="c1"># Optionally you can save the plot as an image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s2">&quot;Fig2.1.png&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Shows all the plot calls in this cell and &quot;clears&quot; the plotting space. Must come after any saving you want to do</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/ViewData_25_0.png" src="../../../_images/ViewData_25_0.png" />
</div>
</div>
</section>
<section id="exercise-2-1-a-clearer-plot">
<h3>Exercise 2.1: A clearer plot<a class="headerlink" href="#exercise-2-1-a-clearer-plot" title="Permalink to this headline">#</a></h3>
<p>Plot the data from Segment FUVB, similar to the Segment FUVA plot above, but this time, normalize flux to a max of 1, and don’t plot the red markers, which can be distracting.</p>
<p>Note what can you simply copy over, and what you have to make sure to change.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code here</span>
</pre></div>
</div>
</div>
</div>
<p><a id = plotcompV></a></p>
</section>
<section id="a-complex-look-at-the-entire-fuv">
<h3>2.1.2. A Complex Look at the Entire FUV<a class="headerlink" href="#a-complex-look-at-the-entire-fuv" title="Permalink to this headline">#</a></h3>
<p><strong>Now that we have an idea for how <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> works, let’s make a more complicated graph showing both FUV segments - <em>independently and together</em>.</strong></p>
<p>One of the most important steps to creating a plot is planning out how it will look and convey its information. We’ll begin by planning this out below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Panel</p></th>
<th class="head"><p>Contents</p></th>
<th class="head"><p>Information Conveyed</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>top</em></p></td>
<td><p>Entire FUV Spectrum as a <strong>simple plot</strong></p></td>
<td><p>Overview of the entire spectrum we have, coarse look without much detail</p></td>
<td><p>Color by segment</p></td>
</tr>
<tr class="row-odd"><td><p><em>middle</em></p></td>
<td><p>Shorter Wavelength FUVB Spectrum as an <strong>errorbar plot</strong></p></td>
<td><p>Closer look at the shorter wavelength spectrum with an idea of error</p></td>
<td><p>Color errorbar by segment, central line in black</p></td>
</tr>
<tr class="row-even"><td><p><em>bottom</em></p></td>
<td><p>Longer Wavelength FUVA Spectrum as an <strong>errorbar plot</strong></p></td>
<td><p>Closer look at the longer wavelength spectrum with an idea of error</p></td>
<td><p>Color errorbar by segment, central line in black</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ax0, ax1, ax2 are our 3 vertically-aligned panels: top, middle, and bottom</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Repeats for i=[0,1] to apply to each segment&#39;s data at a time</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="c1"># Selects all useful data for the chosen segment</span>
    <span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">,</span>
                                                   <span class="s2">&quot;FLUX&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

    <span class="c1"># This section applies the top (0th) panel&#39;s plotting and formatting:</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">segment_colors</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fig 2.2</span><span class="se">\n</span><span class="s2">FUV Spectra with G160M Grating&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1428</span><span class="p">,</span> <span class="mi">1805</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1E-15</span><span class="p">,</span> <span class="mf">1.9E-14</span><span class="p">)</span>

    <span class="c1">######</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># This indented code applies only to segment FUVA data in bottom Panel</span>
        <span class="n">markers</span><span class="p">,</span> <span class="n">caps</span><span class="p">,</span> <span class="n">bars</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr</span><span class="p">,</span>
                                           <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                           <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">segment_colors</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1610</span><span class="p">,</span> <span class="mi">1810</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">3E-15</span><span class="p">,</span> <span class="mf">1.9E-14</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="p">[</span><span class="n">bar</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">]</span>

    <span class="c1">######</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># This indented code applies only to segment FUVB data in middle Panel</span>
        <span class="n">markers</span><span class="p">,</span> <span class="n">caps</span><span class="p">,</span> <span class="n">bars</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr</span><span class="p">,</span>
                                           <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">segment_colors</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1428</span><span class="p">,</span> <span class="mi">1615</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1E-15</span><span class="p">,</span> <span class="mf">1.25E-14</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="p">[</span><span class="n">bar</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">]</span>

    <span class="c1">######</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;Fig2.2.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/ViewData_29_0.png" src="../../../_images/ViewData_29_0.png" />
</div>
</div>
<p><a id = plotcloserV></a></p>
</section>
<section id="looking-closer-at-parts-of-the-fuv-spectrum">
<h3>2.1.3. Looking Closer at Parts of the FUV Spectrum<a class="headerlink" href="#looking-closer-at-parts-of-the-fuv-spectrum" title="Permalink to this headline">#</a></h3>
<p><strong>It can be very difficult to get any insights on small-scale details in the above plots because data is too dense to parse at once. Below, we’ll show examples of:</strong></p>
<ul class="simple">
<li><p>Plotting a small region around an absorption line feature.</p></li>
<li><p>Plotting an entire segment’s spectrum in segments of wavelength space.</p></li>
</ul>
<p><strong>Let’s begin with showing a region around a line, in this case, we see a sharp line around 1670 Å.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">line1670</span> <span class="o">=</span> <span class="mf">1670.67</span>  <span class="c1"># By-eye center of the line for plotting</span>

<span class="c1"># Selects all useful data for the chosen segment</span>
<span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">,</span>
                                               <span class="s2">&quot;FLUX&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

<span class="n">wvln_extent</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># How many Angstroms in each direction around line1670 do we want to look at?</span>

<span class="c1"># Mask the data to within +/- wvln_extent Angstrom of the line - speeds up the plotting</span>
<span class="n">lineRegion_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">wvln</span> <span class="o">&gt;</span> <span class="n">line1670</span> <span class="o">-</span> <span class="n">wvln_extent</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wvln</span> <span class="o">&lt;</span>
                                                     <span class="n">line1670</span> <span class="o">+</span> <span class="n">wvln_extent</span><span class="p">)</span>
<span class="c1"># applies the created mask</span>
<span class="n">wvln_region</span><span class="p">,</span> <span class="n">flux_region</span><span class="p">,</span> <span class="n">fluxErr_region</span> <span class="o">=</span> <span class="n">wvln</span><span class="p">[</span>
    <span class="n">lineRegion_mask</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="n">lineRegion_mask</span><span class="p">],</span> <span class="n">fluxErr</span><span class="p">[</span><span class="n">lineRegion_mask</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># how big should the plot be</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">line1670</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span>  <span class="c1"># vertical line at x position line1670; color = &#39;k&#39; AKA black, line thickness = 4 points, type of line is dotted</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$Approximate\ line\ center$&quot;</span><span class="p">)</span>  <span class="c1"># alpha sets transparency where 1 is opaque; label for the legend</span>

<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln_region</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux_region</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr_region</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;COS FUVA&#39;</span><span class="p">,</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>  <span class="c1"># marker tells the point to look like a dot</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;Fig2.3.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fig. 2.3</span><span class="se">\n</span><span class="s2">Zoom in on the line at 1670 $\AA$&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Fig. 2.3\nZoom in on the line at 1670 $\\AA$&#39;)
</pre></div>
</div>
<img alt="../../../_images/ViewData_31_1.png" src="../../../_images/ViewData_31_1.png" />
</div>
</div>
<p>The source we’re looking at - the quasar 3C48 has a substantial redshift: $<span class="math notranslate nohighlight">\(z \approx 0.37\)</span>$</p>
<p>Source: <a class="reference external" href="http://simbad.u-strasbg.fr/simbad/sim-basic?Ident=3c48&amp;submit=SIMBAD+search">Simbad search for 3C48</a></p>
<p>With that redshift, we can determine the rest-frame wavelength.</p>
<div class="math notranslate nohighlight">
\[z = \dfrac{\lambda_{obs}-\lambda_{rest}}{\lambda_{rest}} \ \ \rightarrow\ \ \ \lambda_{rest} = \dfrac{\lambda_{obs}}{1+z}\]</div>
<p>At that redshift, we see this line to be <span class="math notranslate nohighlight">\(\approx 1219\)</span> Å. This is close to, and may correspond to, the Lyman-<span class="math notranslate nohighlight">\(\alpha\)</span> transition.</p>
<p><font size="5"><b>Now we will create a much more complex plot,</b></font> <font size="3">allowing us to visualize an entire segment’s spectrum in fine detail</font>
We’ll split the spectrum into “segments” of ~10 Angstroms, and plot these segments in a vertical series. These plots may take a minute to create. If you want them to run quicker, hit the <code class="docutils literal notranslate"><span class="pre">Interrupt</span> <span class="pre">the</span> <span class="pre">Kernel</span></code> square-shaped button to stop the current cell from running (you will get an error message), and run this cell with a smaller number of rows.
<a id="fig2p4V"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Let&#39;s see how long it takes with the above &quot;Cell magic&quot; ...</span>
<span class="c1"># (Cell magic is a Jupyter/iPython series of utilities: https://ipython.readthedocs.io/en/stable/interactive/magics.html)</span>
<span class="k">for</span> <span class="n">segment_row</span> <span class="ow">in</span> <span class="n">fuv_x1d_data</span><span class="p">:</span>  <span class="c1"># Apply the following to each segment&#39;s data at a time</span>
    <span class="c1"># Selects all immediately useful data for the chosen segment</span>
    <span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">segment_row</span><span class="p">[</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">,</span>
                                               <span class="s2">&quot;FLUX&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

    <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">wvln</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wvln</span><span class="p">)</span>
    <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flux</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
    <span class="n">rangex</span> <span class="o">=</span> <span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

    <span class="n">nRows</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># How many segments we wish to split the spectrum into</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRows</span><span class="p">):</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="n">minx</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">rangex</span><span class="o">/</span><span class="n">nRows</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="n">minx</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">rangex</span><span class="o">/</span><span class="n">nRows</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nRows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># A way to set Title, xlabel, and ylabel that will work independent of number of rows</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fig. 2.4</span><span class="si">{</span><span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">Segment </span><span class="si">{</span><span class="n">segment</span><span class="si">}</span><span class="s2"> Spectrum split into segments&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nRows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">nRows</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                <span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># Create the plot itself</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">nRows</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;Fig2.4</span><span class="si">{</span><span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">nRows</span><span class="si">}</span><span class="s1">Rows_seg</span><span class="si">{</span><span class="n">segment</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/ViewData_34_0.png" src="../../../_images/ViewData_34_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----
</pre></div>
</div>
<img alt="../../../_images/ViewData_34_2.png" src="../../../_images/ViewData_34_2.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----

CPU times: user 19.4 s, sys: 823 ms, total: 20.2 s
Wall time: 19.4 s
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-2-2-choosing-and-plotting-a-useful-data-range">
<h3>Exercise 2.2 Choosing and plotting a useful data range<a class="headerlink" href="#exercise-2-2-choosing-and-plotting-a-useful-data-range" title="Permalink to this headline">#</a></h3>
<p>That last plot was very dense with information. As practice plotting, make a scaled down version from just <code class="docutils literal notranslate"><span class="pre">1635</span> <span class="pre">-</span> <span class="pre">1675</span></code> Angstroms, and plot the data as a simple line graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code here</span>
</pre></div>
</div>
</div>
</div>
<p><a id = specvizV></a></p>
</section>
<section id="reading-and-plotting-the-data-with-specutils-optional">
<h3>2.1.4. Reading and plotting the data with <code class="docutils literal notranslate"><span class="pre">specutils</span></code> (<em>OPTIONAL</em>)<a class="headerlink" href="#reading-and-plotting-the-data-with-specutils-optional" title="Permalink to this headline">#</a></h3>
<p><font size="5"> <em>Note, this section is entirely optional, and simply meant to give you more options for how to plot a spectrum.</em></font></p>
<p>An alternative way to read in and work with spectral data is with the <a class="reference external" href="https://specutils.readthedocs.io/en/stable/"><code class="docutils literal notranslate"><span class="pre">specutils</span></code> package</a>, which contains <em>quite a bit of functionality</em> for working with spectra. It also can make dealing with units easier, as it generally works well with astropy units and other modules. Make sure that your package is up to date (version <span class="math notranslate nohighlight">\(\ge\)</span> 1.1). We describe installing <code class="docutils literal notranslate"><span class="pre">specutils</span></code> in our <a class="reference external" href="https://github.com/spacetelescope/notebooks/blob/master/notebooks/COS/Setup/Setup.ipynb">Notebook on setting up an environment</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">specutils</span></code> treats spectra as special python objects rather than lists, and reads in the entire spectrum over both segments.</p>
<p>Below is a simple example of using <code class="docutils literal notranslate"><span class="pre">specutils</span></code> to read-in, plot, and continuum-normalize our entire spectrum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">specutils</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">fit_generic_continuum</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="c1"># The default fontsize it will use does not be clear at this plot size</span>
<span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>

<span class="n">spec1d</span> <span class="o">=</span> <span class="n">specutils</span><span class="o">.</span><span class="n">Spectrum1D</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fuv_x1d_filepath</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot the non-normalized flux</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec1d</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Fig. 2.5</span><span class="se">\n</span><span class="s2">Producing spectra with specutils</span><span class="se">\n</span><span class="s2">Un-normalized flux&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Continuum Normalize the flux:</span>
<span class="n">cont_norm_spec1d</span> <span class="o">=</span> <span class="n">spec1d</span> <span class="o">/</span> <span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">spec1d</span><span class="p">)(</span><span class="n">spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">)</span>

<span class="c1"># Plot the normalized flux</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cont_norm_spec1d</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">cont_norm_spec1d</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Normalized flux&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Unitless&quot;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;Fig2.5.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Not necessary for this plot, but gives us all the data separately</span>
<span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span> <span class="o">=</span> <span class="n">spec1d</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">spec1d</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">spec1d</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">quantity</span>
<span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>  <span class="c1"># Restore default fontsize</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: Model is linear in parameters; consider using linear fitting methods. [astropy.modeling.fitting]
</pre></div>
</div>
<img alt="../../../_images/ViewData_38_1.png" src="../../../_images/ViewData_38_1.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">specutils</span></code> also works with the visualization <a class="reference external" href="https://github.com/spacetelescope/jdaviz">package <code class="docutils literal notranslate"><span class="pre">Jdaviz.Specviz</span></code></a>, to produce very useful interactive spectral plots within a jupyter Notebook GUI framework. Currently, this interactive program works well within the Jupyter Notebook environment, but not within Jupyter Lab environment.</p>
<p><a id=nuvV></a></p>
</section>
</section>
<section id="plotting-an-nuv-spectrum">
<h2>2.2. Plotting an NUV Spectrum<a class="headerlink" href="#plotting-an-nuv-spectrum" title="Permalink to this headline">#</a></h2>
<p>The NUV data is formatted very similarly to the FUV data, and can be accessed as in <a class="reference external" href="#readInV">Section 1</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we read in the data - we may ignore warnings about slashes in the notation</span>
<span class="n">nuv_x1d_data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nuv_x1d_filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: UnitsWarning: &#39;erg /s /cm**2 /angstrom&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
WARNING: UnitsWarning: &#39;count /s /pixel&#39; contains multiple slashes, which is discouraged by the FITS standard [astropy.units.format.generic]
</pre></div>
</div>
</div>
</div>
<p><a id = nuv1V></a></p>
<section id="examining-the-first-order-spectrum">
<h3>2.2.1. Examining the first-order spectrum<a class="headerlink" href="#examining-the-first-order-spectrum" title="Permalink to this headline">#</a></h3>
<p><strong>Again, let’s select the simplest data we need to plot a spectrum: WAVELENGTH, FLUX, and ERROR</strong>.</p>
<p>We will limit this first plot to only our first order spectra (we will exclude stripe C). We will plot these two spectra together (in the top panel) and then stripe-by-stripe in the lower 2 panes, similar to fig. 2.2.</p>
<ul class="simple">
<li><p>The former view gives a better sense of the continuum</p></li>
<li><p>The latter views show zooms which allow us to meaningfully view the errors and see specific emission/absorption features.</p></li>
</ul>
<p>The way we produce this plot with <code class="docutils literal notranslate"><span class="pre">Python</span></code> in the cell below is looping through both NUV first-order stripes - NUVA and NUVB - plotting both of them in the upper subplot, and plotting each of them once more in one of the lower two subplots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build a 3row x 1column - subplot figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># Iterate through the first 2 NUV segments/stripes</span>
    <span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span> \
        <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;ERROR&quot;</span><span class="p">],</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>  <span class="c1"># Gather data</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>  <span class="c1"># Plot both segments/stripes in first panel</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">segment_colors</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s2">&quot;Fig 2.6</span><span class="se">\n</span><span class="s2">First-order NUV Spectra with G230L Grating&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Plot only 0th segment/stripe in 2nd panel</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr</span><span class="p">,</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">segment_colors</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">2100</span><span class="p">,</span> <span class="mi">2510</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.5E-13</span><span class="p">,</span> <span class="mf">1.5E-13</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Plot only 1th segment/stripe in 3rd panel</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr</span><span class="p">,</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">segment_colors</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">3190</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1E-14</span><span class="p">,</span> <span class="mf">4.5E-14</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;Fig2.6.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/ViewData_43_0.png" src="../../../_images/ViewData_43_0.png" />
</div>
</div>
<p><a id = nuv2V></a></p>
</section>
<section id="examining-the-second-order-spectrum">
<h3>2.2.2. Examining the second-order spectrum<a class="headerlink" href="#examining-the-second-order-spectrum" title="Permalink to this headline">#</a></h3>
<p>On NUV stripe C data taken with the grating G230L, we have a more dispersed, second-order spectrum over a smaller segment of the NUV. Below, we plot this second-order over the first-order spectrum from stripe A.</p>
<p>Note that most NUV gratings produce first-order spectra over all three stripes. See the <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-5-spectroscopy-with-cos/5-1-the-capabilities-of-cos#id-5.1TheCapabilitiesofCOS-Section5.1.35.1.3Second-OrderSensitivity">Instrument Handbook</a> for more information. We chose to plot this this type of spectrum to create a more complex plot and to demonstrate using different scales on the same axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># We reverse this order. The 0th stripe (A) is plotted OVER the 2nd stripe (C). It&#39;s purely aesthetic.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
    <span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span> <span class="n">nuv_x1d_data</span><span class="p">[</span>
        <span class="n">i</span><span class="p">][</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;ERROR&quot;</span><span class="p">],</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr</span><span class="p">,</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr</span><span class="p">,</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr</span><span class="p">,</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">segment_colors</span><span class="p">[</span><span class="n">segment</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wvln</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">fluxErr</span><span class="p">,</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">segment_colors</span><span class="p">[</span><span class="n">segment</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>


<span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">2100</span><span class="p">,</span> <span class="mi">2510</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.48E-13</span><span class="p">,</span> <span class="mf">1.75E-13</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Fig 2.7</span><span class="se">\n</span><span class="s2">Overlay of First and Second-order Spectrum with G230L Grating&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">2200</span><span class="p">,</span> <span class="mi">2210</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.6E-13</span><span class="p">,</span> <span class="mf">1.75E-13</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span>
         <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>

<span class="c1"># Let&#39;s add a dashed rectangle to show where we are zooming into in the lower panel.</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">2210</span><span class="p">,</span> <span class="mi">2200</span><span class="p">,</span> <span class="mi">2200</span><span class="p">,</span> <span class="mi">2210</span><span class="p">,</span> <span class="mi">2210</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.6E-13</span><span class="p">,</span> <span class="mf">0.6E-13</span><span class="p">,</span> <span class="mf">1.7E-13</span><span class="p">,</span> <span class="mf">1.7E-13</span><span class="p">,</span> <span class="mf">0.6E-13</span><span class="p">],</span>
         <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Lower panel zoom bounds&quot;</span><span class="p">)</span>


<span class="c1"># These lines just ensure that the legend is ordered correctly (first ax0)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>  <span class="c1"># Now for ax1</span>
<span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;Fig2.7.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/ViewData_45_0.png" src="../../../_images/ViewData_45_0.png" />
</div>
</div>
<p><strong>Clearly, our errorbars on the second-order spectrum are <em>much larger</em>.</strong></p>
<p>However, if we need a very high dispersion - for instance, to split closely-spaced lines - the lower panel (zoom) shows a potential advantage of stripe C. Its higher spectral sampling rate can allow for finer distinctions in wavelength, <em>if</em> an acceptable SNR can be reached.</p>
<p><a id = AssessingV></a></p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="preliminary-review-of-the-data">
<h1>3. Preliminary Review of the Data<a class="headerlink" href="#preliminary-review-of-the-data" title="Permalink to this headline">#</a></h1>
<p><font size="4"><b>There is no one-size-fits-all approach to analyzing COS data.</b></font></p>
<p>This section aims to walk you through taking a brief critical look at your data by taking the first steps of <a class="reference external" href="https://en.wikipedia.org/wiki/Data_binning">binning</a> the data, (to the size of COS’ resolution elements - called <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-3-description-and-performance-of-the-cos-optics/3-2-size-of-a-resolution-element">resels</a>), and then measuring the Signal-to-Noise Ratio (<a class="reference external" href="https://en.wikipedia.org/wiki/Signal-to-noise_ratio">SNR</a>).</p>
<p><em>Note that the cell below is only necessary if you have chosen to skip sections #1 and #2</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure these point to your new FUV data</span>
<span class="n">fuv_x1d_filepath</span> <span class="o">=</span> <span class="s1">&#39;./data/mastDownload/HST/lcxv13050/lcxv13050_x1dsum.fits&#39;</span>
<span class="n">fuv_x1d_data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fuv_x1d_filepath</span><span class="p">)</span>
<span class="c1"># Make sure these point to your new NUV data</span>
<span class="n">nuv_x1d_filepath</span> <span class="o">=</span> <span class="s1">&#39;./data/mastDownload/HST/lbbd01020/lbbd01020_x1dsum.fits&#39;</span>
<span class="n">nuv_x1d_data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nuv_x1d_filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = DataQualV></a></p>
<section id="data-quality-and-initial-cleanup">
<h2>3.1. Data Quality and Initial Cleanup<a class="headerlink" href="#data-quality-and-initial-cleanup" title="Permalink to this headline">#</a></h2>
<p>One of the first things one notices in all of the plots we have made is that all of the segments/stripes have real, useful data, bookended on each side by zeros (see, for example, <a class="reference external" href="#fig2p1">Fig. 2.1</a>).
These zeros are regions on the active area of the detector which don’t receive and detect light, but <em>are</em> read in as data. We don’t want these datapoints in our spectra, so we will filter them out.</p>
<p>The COS data we have downloaded conveniently have an extension devoted to data quality information. Information on the data quality array and the flags it contains can be found in <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-2-cos-data-files/2-7-error-and-data-quality-array">Table 2.18 of the COS Data Handbook</a>.</p>
<p>Let’s first look at the data quality flags. We’ll do this by plotting a histogram, labelling the bins according to what the data quality value of that bin means. We add hatching to the histograms to make it easier to see where certain segments overlap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To make plotting the bins linearly work, we deal with the base2 logs of the power-of-2 data quality values</span>

<span class="c1"># The values are all powers of two from 2**1 to 2**14, except for 0, which is 2**-inf</span>
<span class="n">bins_titles</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
<span class="n">meanings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;No Anomalies&#39;</span><span class="p">,</span> <span class="s1">&#39;Reed-Solomon Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Hot Spot&#39;</span><span class="p">,</span> <span class="s1">&#39;Detector Shadow&#39;</span><span class="p">,</span> <span class="s1">&#39;Poorly Calibrated Region&#39;</span><span class="p">,</span>  <span class="c1"># What each power of 2 means in order</span>
            <span class="c1"># More info in the data handbook</span>
            <span class="s1">&#39;Very-low Response Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Background Feature&#39;</span><span class="p">,</span> <span class="s1">&#39;Burst&#39;</span><span class="p">,</span> <span class="s1">&#39;Pixel Out-of-bounds&#39;</span><span class="p">,</span> <span class="s1">&#39;Fill Data&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Pulse Height Out-of-bounds&#39;</span><span class="p">,</span> <span class="s1">&#39;Low Response Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Bad Time Interval&#39;</span><span class="p">,</span> <span class="s1">&#39;Low PHA Feature&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Gain-sag Hole&#39;</span><span class="p">,</span> <span class="s1">&#39;Not Used&#39;</span><span class="p">]</span>

<span class="c1"># pair the meaning with its power of 2 value in a single string</span>
<span class="n">meanings2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">mn</span> <span class="k">for</span> <span class="n">bt</span><span class="p">,</span> <span class="n">mn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bins_titles</span><span class="p">,</span> <span class="n">meanings</span><span class="p">)]</span>

<span class="c1"># Top (FUV) subplot and bottom (NUV) subplot</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Suppress a divide by zero warning</span>
<span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># First loop through the 2 FUV segments to make the top plot</span>
    <span class="c1"># Gather the data</span>
    <span class="n">dataQual</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;DQ&quot;</span><span class="p">],</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>
    <span class="n">bins_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>  <span class="c1"># all the log2 of the DQ values</span>
    <span class="n">bins_titles</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
    <span class="n">logDQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">dataQual</span><span class="p">)</span>
    <span class="n">logDQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">logDQ</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="c1"># Add hatching to distinguish overlapping colors</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">logDQ</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cmy&#39;</span><span class="p">[</span>
             <span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;|-&#39;</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fig. 3.1</span><span class="se">\n</span><span class="s2">Data quality flag frequencies&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># Next loop through the 3 NUV segments/stripes to make bottom plot</span>
    <span class="c1"># Gather the data</span>
    <span class="n">dataQual</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;DQ&quot;</span><span class="p">],</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>
    <span class="n">bins_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>  <span class="c1"># all the log2 of the DQ values</span>

    <span class="n">logDQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">dataQual</span><span class="p">)</span>
    <span class="n">logDQ</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">logDQ</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Add hatching to distinguish overlapping colors</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">logDQ</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cmy&#39;</span><span class="p">[</span>
             <span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;|-/&#39;</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="c1"># suppress a divide by zero warning</span>
<span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">bins_</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">meanings2</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_tight_layout</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;Fig3.1.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">line</span> <span class="mi">18</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="c1"># Suppress a divide by zero warning</span>
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># First loop through the 2 FUV segments to make the top plot</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="c1"># Gather the data</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">dataQual</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;DQ&quot;</span><span class="p">],</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/numpy/__init__.py:320,</span> in <span class="ni">__getattr__</span><span class="nt">(attr)</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span>     <span class="kn">from</span> <span class="nn">.testing</span> <span class="kn">import</span> <span class="n">Tester</span>
<span class="g g-Whitespace">    </span><span class="mi">318</span>     <span class="k">return</span> <span class="n">Tester</span>
<span class="ne">--&gt; </span><span class="mi">320</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;module </span><span class="si">{!r}</span><span class="s2"> has no attribute &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span>                      <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

<span class="ne">AttributeError</span>: module &#39;numpy&#39; has no attribute &#39;warnings&#39;
</pre></div>
</div>
<img alt="../../../_images/ViewData_50_1.png" src="../../../_images/ViewData_50_1.png" />
</div>
</div>
<p>When the data is processed through <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code>, it has a summed set of “Serious Data Quality” <a class="reference external" href="https://hst-docs.stsci.edu/cosdhb/chapter-3-cos-calibration/3-4-descriptions-of-spectroscopic-calibration-steps">SDQ</a> flags attached to it in the form of a single integer between 0 and <span class="math notranslate nohighlight">\(2^{15}\)</span>. This value is found in the 1-th header as <code class="docutils literal notranslate"><span class="pre">&quot;SDQFLAGS&quot;</span></code>. This can be decomposed into the powers of 2 data flags above, (by showing its binary representation,) and tells the pipeline whether to weight that pixel in that exposure by 0 or 1. These weights are then stored in the <code class="docutils literal notranslate"><span class="pre">x1d</span></code> and <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> files, in the <code class="docutils literal notranslate"><span class="pre">&quot;DQ_WGT&quot;</span></code> column. The <code class="docutils literal notranslate"><span class="pre">&quot;DQ_WGT&quot;</span></code> value for a given pixel in the <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> file will then be equal to the number of exposures which went into creating that <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> file in which no serious data quality flags apply to that pixel.</p>
<p>Below, we first see <em>which</em> data quality flags the pipeline considered “serious”, and then demonstrate masking out the datapoints assigned a weight of 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdqFlags_fuv</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">fuv_x1d_filepath</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="s2">&quot;SDQFLAGS&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;The FUV was processed with SDQFLAGS = </span><span class="si">{</span><span class="n">sdqFlags_fuv</span><span class="si">}</span><span class="s2">, which in binary is </span><span class="si">{</span><span class="nb">bin</span><span class="p">(</span><span class="n">sdqFlags_fuv</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Thus, the following DQ-flagged data get weighted by 0:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">sdqFlags_fuv</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]):</span>
    <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="si">{</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="si">}</span><span class="s2">&#39;s place - &quot;</span><span class="p">,</span> <span class="n">meanings</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter the datapoints to where there are no serious DQ flags</span>
<span class="n">mask_noSDQ</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;DQ_WGT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">wvln_FUVA_noSDQ</span><span class="p">,</span> <span class="n">flux_FUVA_noSDQ</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">][</span>
    <span class="n">mask_noSDQ</span><span class="p">],</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;FLUX&quot;</span><span class="p">][</span><span class="n">mask_noSDQ</span><span class="p">]</span>

<span class="c1"># Make the figure:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the filtered datapoints</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln_FUVA_noSDQ</span><span class="p">,</span> <span class="n">flux_FUVA_noSDQ</span><span class="p">)</span>

<span class="c1"># Format the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fig 3.2</span><span class="se">\n</span><span class="s2">FUVA without SDQ flagged data&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;Fig3.2.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively, we can ignore the SDQFLAGS and the weights decided by <code class="docutils literal notranslate"><span class="pre">CalCOS</span></code> and pick which data quality flags we want to filter out. From Fig 3.1, we know the only problem in the FUV and the largest problem in the NUV are pixels flagged by <strong>“out of bounds”</strong>, corresponding to Data Quality: <strong>128</strong>.</p>
<p>We will demonstrate removing only these datapoints from the FUV data below. You could also filter to only data with <em>0: no anomalies</em>, or to any other subset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">dataQual</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span>\
        <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;ERROR&quot;</span><span class="p">],</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;DQ&quot;</span><span class="p">],</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln</span><span class="p">[</span><span class="n">dataQual</span> <span class="o">!=</span> <span class="mf">128.0</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="n">dataQual</span> <span class="o">!=</span> <span class="mf">128.0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#d55e00&#39;</span><span class="p">,</span> <span class="s1">&#39;#009e73&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="si">}</span><span class="s2"> Cleaned&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wvln</span><span class="p">[</span><span class="n">dataQual</span> <span class="o">==</span> <span class="mf">128.0</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="n">dataQual</span> <span class="o">==</span> <span class="mf">128.0</span><span class="p">],</span>
                <span class="n">s</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o.&quot;</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="si">}</span><span class="s2"> Pix out-of-bounds&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fig. 3.3</span><span class="se">\n</span><span class="s2">Removing only out-of-bounds pixels from the FUV</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span> <span class="o">/</span> <span class="s1">&#39;Fig3.3.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<section id="exercise-3-1-removing-all-flagged-data-from-the-nuv">
<h3>Exercise 3.1: <em>Removing all flagged data from the NUV</em><a class="headerlink" href="#exercise-3-1-removing-all-flagged-data-from-the-nuv" title="Permalink to this headline">#</a></h3>
<p>The NUV data has flags for more than just out-of-bounds pixels.</p>
<ol class="simple">
<li><p>Filter out all data which has been flagged</p></li>
<li><p>Plot the NUV spectrum from stripes NUVA and NUVB</p></li>
<li><p>Plot the flagged data in another color to see where the removed data is</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your answer here</span>
</pre></div>
</div>
</div>
</div>
<p><a id=BinningV></a></p>
</section>
</section>
<section id="binning">
<h2>3.2. Binning<a class="headerlink" href="#binning" title="Permalink to this headline">#</a></h2>
<p>Up until now, the data we’ve been working with has one value per “pixel” of the detector.
COS data is generally binned to a resolution element, or <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-3-description-and-performance-of-the-cos-optics/3-2-size-of-a-resolution-element">resel</a>, when working with it. These resels are <em>generally</em> the following sizes <em>in pixels</em>.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>FUV</p></th>
<th class="head"><p>NUV</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Dispersion Axis</strong></p></td>
<td><p>6</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Cross-Dispersion Axis</strong></p></td>
<td><p>10</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
<p>So, for the FUV, we generally want to preliminarily bin our <code class="docutils literal notranslate"><span class="pre">x1d</span></code> or <code class="docutils literal notranslate"><span class="pre">x1dsum</span></code> data by 6.</p>
<p><a id=BinfunV></a></p>
<section id="bringing-in-some-useful-functions-for-binning">
<h3>3.2.1. Bringing in Some Useful Functions for Binning<a class="headerlink" href="#bringing-in-some-useful-functions-for-binning" title="Permalink to this headline">#</a></h3>
<p>In the same subdirectory of the <a class="reference external" href="https://github.com/spacetelescope/notebooks">spacetelescope/notebooks GitHub repository</a> as this file (<code class="docutils literal notranslate"><span class="pre">notebooks/COS/ViewData/</span></code>), we also have the <code class="docutils literal notranslate"><span class="pre">Python</span></code> file: <code class="docutils literal notranslate"><span class="pre">cos_functions.py</span></code>, in which we have defined several long functions necessary for this data processing.</p>
<p><em>Note, if you downloaded this Notebook file without cloning the entire GitHub repository, you must also download the file <code class="docutils literal notranslate"><span class="pre">cos_functions.py</span></code> from <a class="reference external" href="https://github.com/spacetelescope/notebooks/tree/master/notebooks/COS/ViewData/">here</a></em>.</p>
<p>In the cell below, we import the function <code class="docutils literal notranslate"><span class="pre">bin_by_resel</span></code> from the file <code class="docutils literal notranslate"><span class="pre">cos_functions.py</span></code>. The <code class="docutils literal notranslate"><span class="pre">bin_by_resel</span></code> function applies the following binning algorithms to an entire COS NUV or FUV dataset. We run the help function to get more information on how the values are binned.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cos_functions</span> <span class="kn">import</span> <span class="n">bin_by_resel</span>
<span class="n">help</span><span class="p">(</span><span class="n">bin_by_resel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id = binfuvV></a></p>
</section>
<section id="binning-the-fuv-data">
<h3>3.2.2. Binning the FUV Data<a class="headerlink" href="#binning-the-fuv-data" title="Permalink to this headline">#</a></h3>
<p><strong>Below we bin our FUV data by 6. Our resulting table is just under <span class="math notranslate nohighlight">\(\dfrac{1}{6}\)</span> the size of our input table, as a few of the last datapoints were cropped.</strong></p>
<p><em>Note</em>, this binning method works well for binsizes which are small compared to the spectrum; however, if you increase your binsize significantly, you may lose important datapoints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binned_fuv_data</span> <span class="o">=</span> <span class="n">bin_by_resel</span><span class="p">(</span><span class="n">fuv_x1d_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Original Dataset Length is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Binned   Dataset Length is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">binned_fuv_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> over </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">binned_fuv_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">binned_fuv_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;WAVELENGTH&#39;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">binned_fuv_data</span>
</pre></div>
</div>
</div>
</div>
<p><a id=SnrV></a></p>
</section>
</section>
<section id="estimating-the-signal-to-noise-snr-ratio">
<h2>3.3. Estimating the Signal-to-Noise (SNR) Ratio<a class="headerlink" href="#estimating-the-signal-to-noise-snr-ratio" title="Permalink to this headline">#</a></h2>
<p><a id=snrfunV></a></p>
<section id="bringing-in-a-useful-function-for-estimating-snr">
<h3>3.3.1.  Bringing in a Useful Function for Estimating SNR<a class="headerlink" href="#bringing-in-a-useful-function-for-estimating-snr" title="Permalink to this headline">#</a></h3>
<p>Below, we define a function to estimate the Signal-to-Noise ratio (SNR or S/N) of our data. One way to estimate the SNR for photon-counting instruments like COS is by the square-root of their number of gross counts. This is a simplification of the equation given for point sources in the <a class="reference external" href="https://hst-docs.stsci.edu/cosihb/chapter-7-exposure-time-calculator-etc/7-3-sensitivity-count-rate-and-signal-to-noise">COS Instrument Handbook Section 7.3</a>:</p>
<div class="math notranslate nohighlight">
\[\dfrac{Signal}{Noise} = \dfrac{C \times t}{\sqrt{C \times t + N_{pix} \times (B_{sky} + B_{det}) \times t}}\]</div>
<p>For bright point sources, <span class="math notranslate nohighlight">\(C &gt;&gt; B_{sky} + B_{det}\)</span>, and this approaches the simpler:</p>
<div class="math notranslate nohighlight">
\[\dfrac{Signal}{Noise} = \sqrt{C \times t} = \sqrt{Gross\ Counts}\]</div>
<p><font size="5">Caution!</font></p>
<img src=figures/warning.png width ="60" title="CAUTION!"> 
This simplification may not hold very well if your source is diffuse or faint.<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cos_functions</span> <span class="kn">import</span> <span class="n">estimate_snr</span>
<span class="n">help</span><span class="p">(</span><span class="n">estimate_snr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>The function <code class="docutils literal notranslate"><span class="pre">estimate_snr</span></code> gives a <span class="math notranslate nohighlight">\(\sqrt{Gross\ Counts}\)</span> estimate of SNR for an input Astropy Table of COS data.</strong></p>
<p>By default, it does not bin the data before calculating the SNR, nor does it weight the output SNR by exposure time; however, it has the functionality to do both. In most cases, a range should be specified over which to calculate the SNR. If no range is specified, then SNR will be computed for all Resels, but no mean/weighted average will be computed; instead, -1 will be returned in place of the mean.</p>
<p><a id = snrregV></a></p>
</section>
<section id="choosing-a-region-to-calculate-snr">
<h3>3.3.2. Choosing a Region to calculate SNR<a class="headerlink" href="#choosing-a-region-to-calculate-snr" title="Permalink to this headline">#</a></h3>
<p>The SNR should be calculated over a region of continuum, rather than one with significant spectral lines.
Looking back to <a class="reference external" href="#fig2p4V">Fig. 2.4</a>, we see a broad stretch with no obvious lines from [1675 - 1690 Å] in the FUVA segment. We’ll make a quick plot of that region below just to check.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># Set up figure</span>
<span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">,</span> <span class="s2">&quot;FLUX&quot;</span><span class="p">]</span>  <span class="c1"># select data</span>
<span class="n">wvln_range_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">wvln</span> <span class="o">&gt;</span> <span class="mi">1670</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wvln</span> <span class="o">&lt;</span> <span class="mi">1700</span><span class="p">)</span>  <span class="c1"># create mask for data</span>

<span class="c1"># Generate the plot itself</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln</span><span class="p">[</span><span class="n">wvln_range_mask</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="n">wvln_range_mask</span><span class="p">])</span>
<span class="c1"># add lines showing the range we&#39;ll calculate SNR over</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1675</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1690</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Format the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fig. 3.4</span><span class="se">\n</span><span class="s2">Range for SNR Calculation&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux</span><span class="se">\n</span><span class="s1">[$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span><span class="o">/</span><span class="s1">&#39;Fig3.4.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Our chosen region, between the black lines, looks quite good for calculating SNR, as it lacks obvious spectral lines.
<a id = snrcalcV></a></p>
</section>
<section id="calculating-the-snr">
<h3>3.3.3. Calculating the SNR<a class="headerlink" href="#calculating-the-snr" title="Permalink to this headline">#</a></h3>
<p>Below, we calculate the SNR of the FUV data over the region [1675, 1690]. <em>Note</em>, we input the unbinned data, and bin by an FUV Resel of 6 first. We’ll leave <code class="docutils literal notranslate"><span class="pre">verbose</span> <span class="pre">=</span> <span class="pre">True</span></code>, so we can see what is going on in the function.</p>
<p>It turns out this dataset has a fairly low SNR. After calculating the SNR and mean SNR over the specified region, we plot both over wavelength.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculates the SNR</span>
<span class="n">res_size</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># Set the correct resel size as in the data handbook</span>
<span class="n">meanSNR_range1675_1690</span><span class="p">,</span> <span class="n">range1675_1690</span> <span class="o">=</span> <span class="n">estimate_snr</span><span class="p">(</span>
    <span class="n">fuv_x1d_data</span><span class="p">,</span> <span class="n">bin_data_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">binsize_</span><span class="o">=</span><span class="n">res_size</span><span class="p">,</span> <span class="n">snr_range</span><span class="o">=</span><span class="p">[</span><span class="mi">1675</span><span class="p">,</span> <span class="mi">1690</span><span class="p">])</span>  <span class="c1"># Gather data</span>
<span class="c1"># Creates a plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">wvln_over_range</span><span class="p">,</span> <span class="n">snr_over_range</span> <span class="o">=</span> <span class="n">range1675_1690</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">range1675_1690</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># range1675_1690 contains a list of data for each segment of the detector (i.e. FUVA and FUVB)</span>
<span class="c1"># If your wavelength range for calculating S/N falls in FUVA, you would access the WAVELENGTH and S/N as:</span>
<span class="c1">#       range1675_1690[1][0], range1675_1690[1][1]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln_over_range</span><span class="p">,</span> <span class="n">snr_over_range</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#466599&#39;</span><span class="p">,</span>
         <span class="c1"># add a marker (black dot) to the plotted line</span>
         <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;SNR Binned by Resel size </span><span class="si">{</span><span class="n">res_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">meanSNR_range1675_1690</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mean SNR over the Region&quot;</span><span class="p">)</span>  <span class="c1"># plot a horizontal line at y = mean SNR</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Fig. 3.5</span><span class="se">\n</span><span class="s2">Results of SNR Calculation by Wavelength&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">plotsdir</span><span class="o">/</span><span class="s1">&#39;Fig3.5.png&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-3-2-binning-the-nuv-data-and-calculating-its-snr">
<h3>Exercise 3.2. <em>Binning the NUV Data and Calculating its SNR</em><a class="headerlink" href="#exercise-3-2-binning-the-nuv-data-and-calculating-its-snr" title="Permalink to this headline">#</a></h3>
<ol class="simple">
<li><p>Bin the NUV data, remembering that the resel size is different than that for the FUV</p></li>
<li><p>Find a continuum region of the NUV data with no significant spectral lines</p></li>
<li><p>Calculate the mean SNR over that region</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code here</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="congratulations-you-finished-this-notebook">
<h2>Congratulations! You finished this Notebook!<a class="headerlink" href="#congratulations-you-finished-this-notebook" title="Permalink to this headline">#</a></h2>
<section id="there-are-more-cos-data-walkthrough-notebooks-on-different-topics-you-can-find-them-here">
<h3>There are more COS data walkthrough Notebooks on different topics. You can find them <a class="reference external" href="https://spacetelescope.github.io/COS-Notebooks/">here</a>.<a class="headerlink" href="#there-are-more-cos-data-walkthrough-notebooks-on-different-topics-you-can-find-them-here" title="Permalink to this headline">#</a></h3>
</section>
</section>
<hr class="docutils" />
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h2>
<p><strong>Author:</strong> <span class="xref myst">Nat Kerman</span></p>
<p><strong>Updated On:</strong> 2022-03-17</p>
<blockquote>
<div><p><em>This tutorial was generated to be in compliance with the <a class="reference external" href="https://github.com/spacetelescope/style-guides">STScI style guides</a> and would like to cite the <a class="reference external" href="https://github.com/spacetelescope/style-guides/blob/master/templates/example_notebook.ipynb">Jupyter guide</a> in particular.</em></p>
</div></blockquote>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Permalink to this headline">#</a></h2>
<p>If you use <code class="docutils literal notranslate"><span class="pre">astropy</span></code>, <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, <code class="docutils literal notranslate"><span class="pre">astroquery</span></code>, or <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for published research, please cite the
authors. Follow these links for more information about citations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.scipy.org/citing.html">Citing <code class="docutils literal notranslate"><span class="pre">astropy</span></code>/<code class="docutils literal notranslate"><span class="pre">numpy</span></code>/<code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></p></li>
<li><p><a class="reference external" href="https://astroquery.readthedocs.io/en/latest/">Citing <code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a></p></li>
</ul>
<hr class="docutils" />
<p><a class="reference external" href="#topV">Top of Page</a>
<img style="float: right;" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" alt="Space Telescope Logo" width="200px"/></p>
<p><br></br>
<br></br>
<br></br></p>
</section>
<section id="exercise-solutions">
<h2>Exercise Solutions:<a class="headerlink" href="#exercise-solutions" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exercise 1.1 Soln</span>
<span class="c1"># 1</span>
<span class="c1"># Here we read in the data - we may ignore any warnings about slashes in the notation</span>
<span class="n">nuv_x1d_data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nuv_x1d_filepath</span><span class="p">)</span>
<span class="c1"># 2</span>
<span class="n">nuv_x1d_header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">nuv_x1d_filepath</span><span class="p">)</span>
<span class="n">nuv_x1d_header1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">nuv_x1d_filepath</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Processed at MJD = </span><span class="si">{</span><span class="n">nuv_x1d_header</span><span class="p">[</span><span class="s1">&#39;PROCTIME&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">Taken with </span><span class="si">{</span><span class="n">nuv_x1d_header1</span><span class="p">[</span><span class="s1">&#39;NUMFLASH&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> wavecal flashes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># 3</span>
<span class="n">nuv_asn_data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nuv_asn_filepath</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nuv_asn_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ex. 2.1 Soln:</span>
<span class="c1"># [0] Accesses FUVA: the longer wvln segment and gets the data we need to plot a spectrum</span>
<span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">,</span> <span class="s2">&quot;FLUX&quot;</span><span class="p">,</span> <span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>
<span class="c1"># [1] Accesses FUVB</span>
<span class="n">wvln</span> <span class="o">*=</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span>  <span class="c1"># Adds unit to the wvln of Angstroms</span>
<span class="c1"># Adds unit to the flux of erg / (Angstrom cm2 s)</span>
<span class="n">flux</span> <span class="o">*=</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">second</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">flux</span> <span class="o">/=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span>
<span class="k">with</span> <span class="n">quantity_support</span><span class="p">():</span>  <span class="c1"># Allows us to view the units attached to the data as the axes labels. This isn&#39;t generally necessary unless you want the unit support.</span>

    <span class="c1"># Sets up the plot as a single box with size of 10x4 inches, and with a dpi of 100, relavent should we choose to save it</span>
    <span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># The next few lines are the core of the cell, where we actually place the data onto the plot:</span>
    <span class="c1">###############</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span>  <span class="c1"># First two arguments are assumed to be the x-data, y-data</span>
            <span class="c1"># These parameters specify the look of the connecting line</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># The marker parameters specify how the data points will look - if you don&#39;t want dots set marker = &#39;&#39;</span>
            <span class="n">label</span><span class="o">=</span><span class="n">segment</span><span class="p">)</span>  <span class="c1"># The label is an optional parameter which will allow us to create a legend - useful when there are multiple datasets on the same plot</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Exercise 2.1</span><span class="se">\n</span><span class="s2">Simple COS Segment FUVB Spectrum&quot;</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># Adds a title of fontsize 20 points</span>

    <span class="c1"># These two lines set the x and y bounds of the image in whatever units we are plotting in</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1420</span><span class="p">,</span> <span class="mi">1620</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Adds a legend with the label specified in the plotting call</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Gets rid of blank space</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Shows all the plot calls in this cell and &quot;clears&quot; the plotting space - must come after any saving you want to do</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ex. 2.2 Soln</span>
<span class="c1"># selects all useful data for the chosen segment = FUVA</span>
<span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">fuv_x1d_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">,</span>
                                               <span class="s2">&quot;FLUX&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

<span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="mi">1635</span><span class="p">,</span> <span class="mi">1675</span>
<span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">flux</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>

<span class="n">wvln_range_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">wvln</span> <span class="o">&gt;</span> <span class="n">minx</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wvln</span> <span class="o">&lt;</span> <span class="n">maxx</span><span class="p">)</span>

<span class="n">wvln</span> <span class="o">=</span> <span class="n">wvln</span><span class="p">[</span><span class="n">wvln_range_mask</span><span class="p">]</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="n">wvln_range_mask</span><span class="p">]</span>
<span class="n">fluxErr</span> <span class="o">=</span> <span class="n">fluxErr</span><span class="p">[</span><span class="n">wvln_range_mask</span><span class="p">]</span>

<span class="n">rangex</span> <span class="o">=</span> <span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">nRows</span> <span class="o">=</span> <span class="mi">3</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRows</span><span class="p">):</span>
    <span class="n">min_</span> <span class="o">=</span> <span class="n">minx</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">rangex</span><span class="o">/</span><span class="n">nRows</span>
    <span class="n">max_</span> <span class="o">=</span> <span class="n">minx</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">rangex</span><span class="o">/</span><span class="n">nRows</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nRows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># A way to set Title, xlabel, and ylabel that will work independent of number of rows</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Ex 2.2 Solution FUV</span><span class="si">{</span><span class="n">segment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">Segment </span><span class="si">{</span><span class="n">segment</span><span class="si">}</span><span class="s2"> spectrum split into segments&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nRows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">nRows</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">nRows</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ex. 3.1 Soln</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">dataQual</span> <span class="o">=</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;DQ&quot;</span><span class="p">]</span>
    <span class="n">wvln</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">fluxErr</span><span class="p">,</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;WAVELENGTH&quot;</span><span class="p">],</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;FLUX&quot;</span><span class="p">],</span>\
        <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;ERROR&quot;</span><span class="p">],</span> <span class="n">nuv_x1d_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;SEGMENT&quot;</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wvln</span><span class="p">[</span><span class="n">dataQual</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="n">dataQual</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="si">}</span><span class="s2"> Un-Flagged Pixel&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wvln</span><span class="p">[</span><span class="n">dataQual</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="n">dataQual</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="si">}</span><span class="s2"> Flagged Pixel&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="s2">&quot;Ex 3.1 Solution</span><span class="se">\n</span><span class="s2">Removing only out-of-bounds pixels from the NUV</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux [$erg\ s^{-1}\ cm^{-2}\ Angstrom^{-1}$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ex. 3.2 Soln</span>

<span class="c1"># This whole process can be accomplished in one line, provided we use Fig 2.6 to find a line free region.</span>
<span class="c1"># We use the estimate_snr function to bin by the NUV resel size of 3, then mean calculate SNR over the region.</span>

<span class="n">meanSNR_nuv_range</span><span class="p">,</span> <span class="n">nuv_range</span> <span class="o">=</span> <span class="n">estimate_snr</span><span class="p">(</span>
    <span class="n">nuv_x1d_data</span><span class="p">,</span> <span class="n">bin_data_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">binsize_</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">snr_range</span><span class="o">=</span><span class="p">[</span><span class="mi">3400</span><span class="p">,</span> <span class="mi">3450</span><span class="p">])</span>

<span class="c1"># Let&#39;s plot it as in Fig 3.5</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nuv_range</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">nuv_range</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SNR Binned by Resel&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">meanSNR_nuv_range</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mean SNR over the Region&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Ex. 3.2 Solution</span><span class="se">\n</span><span class="s2">Results of SNR Calculation&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength [$\AA$]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "therealzoidberg/hst_merge",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/COS/ViewData"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../DataDl/DataDl.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Downloading COS Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../AsnFile/AsnFile.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Modifying or Creating an Association File</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>